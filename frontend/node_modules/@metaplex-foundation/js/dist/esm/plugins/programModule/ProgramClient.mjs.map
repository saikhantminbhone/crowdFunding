{"version":3,"file":"ProgramClient.mjs","sources":["../../../../src/plugins/programModule/ProgramClient.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport type { Metaplex } from '@/Metaplex';\nimport { MissingGpaBuilderError, ProgramNotRecognizedError } from '@/errors';\nimport { Program, Cluster } from '@/types';\nimport { GpaBuilder } from '@/utils';\n\n/**\n * @group Modules\n */\nexport class ProgramClient {\n  protected programs: Program[] = [];\n  constructor(protected readonly metaplex: Metaplex) {}\n\n  register(program: Program): void {\n    this.programs.unshift(program);\n  }\n\n  all(overrides: Program[] = []): Program[] {\n    return [...overrides, ...this.programs];\n  }\n\n  allForCluster(cluster: Cluster, overrides: Program[] = []): Program[] {\n    return this.all(overrides).filter((program) => {\n      return program.clusterFilter?.(cluster) ?? true;\n    });\n  }\n\n  allForCurrentCluster(overrides: Program[] = []): Program[] {\n    return this.allForCluster(this.metaplex.cluster, overrides);\n  }\n\n  get<T extends Program = Program>(\n    nameOrAddress: string | PublicKey,\n    overrides: Program[] = []\n  ): T {\n    const programs = this.allForCurrentCluster(overrides);\n    const program =\n      typeof nameOrAddress === 'string'\n        ? programs.find((program) => program.name === nameOrAddress)\n        : programs.find((program) => program.address.equals(nameOrAddress));\n\n    if (!program) {\n      throw new ProgramNotRecognizedError(nameOrAddress, this.metaplex.cluster);\n    }\n\n    return program as T;\n  }\n\n  public getGpaBuilder<T extends GpaBuilder>(\n    nameOrAddress: string | PublicKey,\n    overrides: Program[] = []\n  ): T {\n    const program = this.get(nameOrAddress, overrides);\n\n    if (!program.gpaResolver) {\n      throw new MissingGpaBuilderError(program);\n    }\n\n    return program.gpaResolver(this.metaplex) as T;\n  }\n}\n"],"names":["ProgramClient","constructor","metaplex","register","program","programs","unshift","all","overrides","allForCluster","cluster","filter","clusterFilter","allForCurrentCluster","get","nameOrAddress","find","name","address","equals","ProgramNotRecognizedError","getGpaBuilder","gpaResolver","MissingGpaBuilderError"],"mappings":";;;AAMA;AACA;AACA;AACO,MAAMA,aAAa,CAAC;EAEzBC,WAAW,CAAoBC,QAAkB,EAAE;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,UAAA,EADnB,EAAE,CAAA,CAAA;IAAA,IACHA,CAAAA,QAAkB,GAAlBA,QAAkB,CAAA;AAAG,GAAA;EAEpDC,QAAQ,CAACC,OAAgB,EAAQ;AAC/B,IAAA,IAAI,CAACC,QAAQ,CAACC,OAAO,CAACF,OAAO,CAAC,CAAA;AAChC,GAAA;AAEAG,EAAAA,GAAG,CAACC,SAAoB,GAAG,EAAE,EAAa;IACxC,OAAO,CAAC,GAAGA,SAAS,EAAE,GAAG,IAAI,CAACH,QAAQ,CAAC,CAAA;AACzC,GAAA;AAEAI,EAAAA,aAAa,CAACC,OAAgB,EAAEF,SAAoB,GAAG,EAAE,EAAa;IACpE,OAAO,IAAI,CAACD,GAAG,CAACC,SAAS,CAAC,CAACG,MAAM,CAAEP,OAAO,IAAK;AAC7C,MAAA,OAAOA,OAAO,CAACQ,aAAa,GAAGF,OAAO,CAAC,IAAI,IAAI,CAAA;AACjD,KAAC,CAAC,CAAA;AACJ,GAAA;AAEAG,EAAAA,oBAAoB,CAACL,SAAoB,GAAG,EAAE,EAAa;IACzD,OAAO,IAAI,CAACC,aAAa,CAAC,IAAI,CAACP,QAAQ,CAACQ,OAAO,EAAEF,SAAS,CAAC,CAAA;AAC7D,GAAA;AAEAM,EAAAA,GAAG,CACDC,aAAiC,EACjCP,SAAoB,GAAG,EAAE,EACtB;AACH,IAAA,MAAMH,QAAQ,GAAG,IAAI,CAACQ,oBAAoB,CAACL,SAAS,CAAC,CAAA;AACrD,IAAA,MAAMJ,OAAO,GACX,OAAOW,aAAa,KAAK,QAAQ,GAC7BV,QAAQ,CAACW,IAAI,CAAEZ,OAAO,IAAKA,OAAO,CAACa,IAAI,KAAKF,aAAa,CAAC,GAC1DV,QAAQ,CAACW,IAAI,CAAEZ,OAAO,IAAKA,OAAO,CAACc,OAAO,CAACC,MAAM,CAACJ,aAAa,CAAC,CAAC,CAAA;IAEvE,IAAI,CAACX,OAAO,EAAE;MACZ,MAAM,IAAIgB,yBAAyB,CAACL,aAAa,EAAE,IAAI,CAACb,QAAQ,CAACQ,OAAO,CAAC,CAAA;AAC3E,KAAA;AAEA,IAAA,OAAON,OAAO,CAAA;AAChB,GAAA;AAEOiB,EAAAA,aAAa,CAClBN,aAAiC,EACjCP,SAAoB,GAAG,EAAE,EACtB;IACH,MAAMJ,OAAO,GAAG,IAAI,CAACU,GAAG,CAACC,aAAa,EAAEP,SAAS,CAAC,CAAA;AAElD,IAAA,IAAI,CAACJ,OAAO,CAACkB,WAAW,EAAE;AACxB,MAAA,MAAM,IAAIC,sBAAsB,CAACnB,OAAO,CAAC,CAAA;AAC3C,KAAA;AAEA,IAAA,OAAOA,OAAO,CAACkB,WAAW,CAAC,IAAI,CAACpB,QAAQ,CAAC,CAAA;AAC3C,GAAA;AACF;;;;"}